# VectorBT Backtesting Skills for Claude Code

A collection of Claude Code skills for backtesting trading strategies using VectorBT with Indian market data via OpenAlgo.

## Quick Install

Install the skills directly into your project using [npx skills](https://github.com/vercel-labs/skills):

```bash
# GitHub shorthand
npx skills add marketcalls/vectorbt-backtesting-skills

# Full GitHub URL
npx skills add https://github.com/marketcalls/vectorbt-backtesting-skills
```

Install a specific skill only:

```bash
npx skills add marketcalls/vectorbt-backtesting-skills -s backtest
npx skills add marketcalls/vectorbt-backtesting-skills -s optimize
npx skills add marketcalls/vectorbt-backtesting-skills -s vectorbt-expert
```

List available skills before installing:

```bash
npx skills add marketcalls/vectorbt-backtesting-skills -l
```

Install globally (available across all projects):

```bash
npx skills add marketcalls/vectorbt-backtesting-skills -g
```

## Prerequisites

### 1. OpenAlgo

This project uses [OpenAlgo](https://github.com/marketcalls/openalgo) as the primary data source for Indian market historical data (NSE, BSE, NFO, MCX).

**Setup OpenAlgo:**

```bash
git clone https://github.com/marketcalls/openalgo.git
cd openalgo
pip install -r requirements.txt
python app.py
```

OpenAlgo runs locally at `http://127.0.0.1:5000` by default. You will need:
- A broker account connected via OpenAlgo
- An API key generated from the OpenAlgo dashboard

Refer to the [OpenAlgo documentation](https://docs.openalgo.in/) for detailed setup instructions.

### 2. Python Environment

Create a virtual environment and install the required libraries:

```bash
python -m venv venv

# Windows
venv\Scripts\activate

# Linux/Mac
source venv/bin/activate

pip install openalgo ta-lib vectorbt yfinance nbformat anywidget plotly python-dotenv
```

**Note on TA-Lib:** TA-Lib requires a C library to be installed first.

- **Windows:** Download the `.whl` file from [TA-Lib Unofficial Binaries](https://github.com/cgohlke/talib-build/releases) and install with `pip install TA_Lib-<version>.whl`
- **Linux:** `sudo apt-get install libta-lib-dev && pip install ta-lib`
- **Mac:** `brew install ta-lib && pip install ta-lib`

### 3. Claude Code

Install [Claude Code](https://docs.anthropic.com/en/docs/claude-code) and run it from the project root directory. The skills will be automatically loaded.

```bash
claude
```

## Skills

### `/backtest` - Quick Backtest

Create a complete backtest script for a given strategy and symbol.

```
/backtest ema-crossover SBIN NSE D
/backtest rsi RELIANCE NSE D
/backtest supertrend NIFTY NFO 5m
/backtest dual-momentum NIFTYBEES GOLDBEES
```

**Supported strategies:** EMA Crossover, RSI, Donchian Channel, Supertrend, MACD Breakout, SDA2, Momentum, Dual Momentum

### `/optimize` - Parameter Optimization

Optimize strategy parameters and generate heatmaps.

```
/optimize ema-crossover SBIN NSE D
```

### `/quick-stats` - Inline Stats

Print key backtest stats without creating a file.

```
/quick-stats RELIANCE
```

### `/strategy-compare` - Compare Strategies

Compare multiple strategies or directions (long vs short vs both) side-by-side.

```
/strategy-compare ema-crossover rsi SBIN NSE D
```

### `vectorbt-expert` - Knowledge Base

Background skill that provides VectorBT expertise for any backtesting conversation. Loaded automatically when discussing backtesting topics.

## Project Structure

```
.
├── .claude/
│   └── skills/               # Claude Code skill definitions
│       ├── backtest/
│       ├── optimize/
│       ├── quick-stats/
│       ├── strategy-compare/
│       └── vectorbt-expert/
├── backtesting/               # Generated backtest scripts
├── requirements.txt
└── README.md
```

## Example Backtesting Scripts

The `backtesting/` directory contains example scripts generated by the skills:

| Script | Strategy | Description |
|--------|----------|-------------|
| `SBIN_ema_crossover_backtest.py` | EMA 10/20 Crossover | Simple moving average crossover on SBIN |
| `dual_momentum_backtest.py` | Dual Momentum | Quarterly rotation between NIFTYBEES and GOLDBEES |
| `buy_hold_75_25_backtest.py` | Buy & Hold 60/40 | Static allocation NIFTYBEES + GOLDBEES |
| `niftybees_rsi_accumulation_backtest.py` | RSI Accumulation | Slab-wise weekly accumulation based on NIFTY RSI |

Each script:
- Fetches data from OpenAlgo
- Implements the strategy with VectorBT
- Prints performance stats and CAGR benchmarks (vs NIFTY 50, FD)
- Generates interactive Plotly charts
- Exports trade logs to CSV

## Data Sources

| Source | Use Case | Exchange Codes |
|--------|----------|----------------|
| OpenAlgo | Indian markets (primary) | NSE, BSE, NFO, MCX, NSE_INDEX |
| Yahoo Finance | Global markets (alternative) | Standard Yahoo tickers |

## Configuration

Backtest scripts read the OpenAlgo API key from:
1. Environment variable `OPENALGO_API_KEY`
2. Or hardcoded in the script (update before running)

```python
client = api(
    api_key=os.getenv("OPENALGO_API_KEY", "your-api-key-here"),
    host=os.getenv("OPENALGO_HOST", "http://127.0.0.1:5000"),
)
```

## License

MIT
